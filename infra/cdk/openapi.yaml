openapi: 3.0.3
info:
  title: DeepCopy API
  version: 1.0.0
  description: |
    API for submitting AI processing jobs and retrieving their status and results.

    Authentication (OAuth2 client credentials via Amazon Cognito):

    ```bash
    # Set endpoints (from CDK outputs)
    API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
    TOKEN_ENDPOINT="https://deepcopy-613663743323-eu-west-1.auth.eu-west-1.amazoncognito.com/oauth2/token"

    # Your app client credentials (retrieve secret from Cognito console)
    CLIENT_ID="<your-client-id>"
    CLIENT_SECRET="<your-client-secret>"

    # Request access token with read+write scopes
    ACCESS_TOKEN=$(curl -s -u "$CLIENT_ID:$CLIENT_SECRET" \
      -d "grant_type=client_credentials&scope=https://deep-copy.api/read https://deep-copy.api/write" \
      "$TOKEN_ENDPOINT" | jq -r .access_token)

    echo "Token acquired: ${#ACCESS_TOKEN} chars"

    # Submit a job
    curl -sS -X POST \
      -H "Authorization: Bearer $ACCESS_TOKEN" \
      -H "content-type: application/json" \
      -d '{
        "sales_page_url": "https://try.meritrelief.com/",
        "project_name": "meritrelief",
        "advertorial_type": "Listicle",
        "persona": "Health-conscious professionals",
        "age_range": "30-45",
        "gender": "female"
      }' \
      "${API_URL}jobs"

    # Get job status (replace with real jobId)
    curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}jobs/YOUR_JOB_ID"

    # Get job result JSON (404 until available)
    curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}jobs/YOUR_JOB_ID/result"
    ```
servers:
  - url: https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/
security:
  - cognitoOAuth2: [ ]
paths:
  /jobs:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit a new job
      operationId: submitJob
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitJobRequest'
            examples:
              minimal:
                summary: Minimal payload
                value: {}
              full:
                summary: Full payload
                value:
                  sales_page_url: "https://try.meritrelief.com/"
                  project_name: "meritrelief"
                  advertorial_type: "Listicle"
                  customer_avatars:
                    - persona_name: "Active Senior"
                      characteristics:
                        - "Active lifestyle"
                        - "Gardening enthusiast"
                        - "Chronic pain"
                      description: "Retired professional who enjoys gardening and light exercise but struggles with chronic sciatic pain"
                      age_range: "60-75"
                      gender: "both"
                      key_buying_motivation: "Seeking non-invasive pain relief to maintain active lifestyle"
                      pain_point: "Chronic sciatic pain prevents them from enjoying favorite activities like gardening"
                      emotion: "Frustrated and limited, feeling their independence slipping away"
                      desire: "A natural solution that allows them to stay active without relying on prescription painkillers"
                      objections:
                        - "Will this actually work for chronic pain?"
                        - "Is it safe for someone my age?"
                        - "Can I afford another wellness product?"
                      failed_alternatives:
                        - "Prescription pain medication with unwanted side effects"
                        - "Physical therapy that didn't provide lasting relief"
                        - "Over-the-counter pain relievers that only work temporarily"
                    - persona_name: "Desk-Bound Professional"
                      characteristics:
                        - "Standing all day"
                        - "Work-related pain"
                        - "Evening fatigue"
                      description: "Office worker sitting 8+ hours daily experiencing lower back pain"
                      age_range: "30-45"
                      gender: "both"
                      key_buying_motivation: "Quick relief from work-related pain"
                      pain_point: "Stands all day at work (nurses, retail staff, warehouse workers). Feet ache, swell, and feel heavy every evening."
                      emotion: "Feels drained and defeated when coming home, wants relief to enjoy family time instead of collapsing on the couch."
                      desire: "Quick daily solution that soothes feet and restores energy without expensive spa visits."
                      objections:
                        - "Will this actually help after a long shift?"
                        - "Can I afford another wellness expense?"
                        - "Do I have time to use this daily?"
                      failed_alternatives:
                        - "Compression socks that don't provide enough relief"
                        - "Soaking feet in warm water (temporary relief only)"
                        - "Pain medication with unwanted side effects"
      responses:
        '202':
          description: Job accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitJobResponse'
              examples:
                accepted:
                  value:
                    jobId: "c3f0e0c4-3a61-4c52-8b5a-2e0a8b8b4a5f"
                    taskArn: "arn:aws:ecs:eu-west-1:123456789012:task/cluster/1234567890abcdef"
                    status: "SUBMITTED"
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-codeSamples:
        - lang: bash
          label: curl (submit)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -X POST \
              -H "Authorization: Bearer $ACCESS_TOKEN" \
              -H "content-type: application/json" \
              -d '{
                "sales_page_url": "https://try.meritrelief.com/",
                "project_name": "meritrelief",
                "advertorial_type": "Listicle",
                "customer_avatars": [
                  {
                    "persona_name": "Active Senior",
                    "characteristics": ["Active lifestyle", "Gardening enthusiast", "Chronic pain"],
                    "description": "Retired professional who enjoys gardening and light exercise but struggles with chronic sciatic pain",
                    "age_range": "60-75",
                    "gender": "both",
                    "key_buying_motivation": "Seeking non-invasive pain relief to maintain active lifestyle"
                  }
                ]
              }' \
              "${API_URL}jobs"
  /jobs/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get job status
      operationId: getJob
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatusResponse'
        '404':
          description: Job not found
          content:
            text/plain:
              schema:
                type: string
                example: "Not found"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (status)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}jobs/YOUR_JOB_ID"
  /jobs/{id}/result:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get job result
      operationId: getJobResult
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Job result JSON or text
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResult'
            text/plain:
              schema:
                type: string
        '404':
          description: Result not available
          content:
            text/plain:
              schema:
                type: string
                example: "Result not available"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (result)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}jobs/YOUR_JOB_ID/result"
  /dev/jobs:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit a new job (DEV MODE)
      description: Submits a job in development mode. The backend will use mock data instead of running full AI processing.
      operationId: submitJobDev
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitJobRequest'
      responses:
        '202':
          description: Job accepted (Dev Mode)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitJobResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /avatars/extract:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit an avatar extraction job
      operationId: submitAvatarExtraction
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url]
              properties:
                url:
                  type: string
                  format: uri
                  description: URL of the product page to analyze
            examples:
              sciatica:
                summary: Sciatica product
                value:
                  url: "https://www.sciatiease.com/sciatiease.php"
      responses:
        '202':
          description: Avatar extraction job accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitAvatarExtractionResponse'
              examples:
                accepted:
                  value:
                    jobId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                    status: "SUBMITTED"
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-codeSamples:
        - lang: bash
          label: curl (submit extraction)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -X POST \
              -H "Authorization: Bearer $ACCESS_TOKEN" \
              -H "content-type: application/json" \
              -d '{"url": "https://www.sciatiease.com/sciatiease.php"}' \
              "${API_URL}avatars/extract"
  /avatars/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Avatar extraction job ID
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get avatar extraction job status
      operationId: getAvatarExtractionStatus
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatusResponse'
        '404':
          description: Job not found
          content:
            text/plain:
              schema:
                type: string
                example: "Not found"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (get status)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}avatars/YOUR_JOB_ID"
  /avatars/{id}/result:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Avatar extraction job ID
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get avatar extraction results
      operationId: getAvatarExtractionResult
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Avatar extraction results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvatarExtractionResponse'
        '404':
          description: Result not available
          content:
            text/plain:
              schema:
                type: string
                example: "Result not available"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (get result)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}avatars/YOUR_JOB_ID/result"
  /dev/avatars/extract:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit an avatar extraction job (DEV MODE)
      description: Submits an avatar extraction job in development mode. Returns mock avatar results.
      operationId: submitAvatarExtractionDev
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [url]
              properties:
                url:
                  type: string
                  format: uri
                  description: URL of the product page to analyze
      responses:
        '202':
          description: Avatar extraction job accepted (Dev Mode)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitAvatarExtractionResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /swipe-files/generate:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit a swipe file generation job
      operationId: submitSwipeFileGeneration
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [original_job_id, select_angle]
              properties:
                original_job_id:
                  type: string
                  format: uuid
                  description: The job ID of the original comprehensive analysis job
                select_angle:
                  type: string
                  description: The marketing angle to focus on for the swipe files
                swipe_file_ids:
                  type: array
                  description: The IDs of the swipe files to generate
                  items:
                    type: string
                    format: uuid
            examples:
              example:
                summary: Generate swipe files for a marketing angle
                value:
                  original_job_id: "03479dbf-bc4c-4472-80ff-b11b561b8777"
                  select_angle: "Embarrassment & Professional Confidence: 'Restore the beard you earned—no flakes in meetings.'"
      responses:
        '202':
          description: Swipe file generation job accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitSwipeFileResponse'
              examples:
                accepted:
                  value:
                    jobId: "03479dbf-bc4c-4472-80ff-b11b561b8777-swipe"
                    status: "SUBMITTED"
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-codeSamples:
        - lang: bash
          label: curl (submit swipe file generation)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -X POST \
              -H "Authorization: Bearer $ACCESS_TOKEN" \
              -H "content-type: application/json" \
              -d '{
                "original_job_id": "03479dbf-bc4c-4472-80ff-b11b561b8777",
                "select_angle": "Embarrassment & Professional Confidence: '\''Restore the beard you earned—no flakes in meetings.'\''"
              }' \
              "${API_URL}swipe-files/generate"
  /swipe-files/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Swipe file generation job ID
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get swipe file generation job status
      operationId: getSwipeFileGenerationStatus
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatusResponse'
        '404':
          description: Job not found
          content:
            text/plain:
              schema:
                type: string
                example: "Not found"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (get status)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}swipe-files/YOUR_JOB_ID"
  /swipe-files/{id}/result:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Swipe file generation job ID
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get swipe file generation results
      operationId: getSwipeFileGenerationResult
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Swipe file generation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SwipeFileGenerationResponse'
        '404':
          description: Result not available
          content:
            text/plain:
              schema:
                type: string
                example: "Result not available"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (get result)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}swipe-files/YOUR_JOB_ID/result"
  /image-gen/generate:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit an image generation job
      operationId: submitImageGen
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitImageGenRequest'
            examples:
              minimal:
                summary: Minimal payload
                value:
                  selectedAvatar: "Men 50-65, skeptical, wants fast relief"
                  selectedAngles:
                    - "Pain relief without pills"
                    - "Get back to walking comfortably"
              full:
                summary: Full payload
                value:
                  selectedAvatar: "Men 50-65, skeptical, wants fast relief"
                  selectedAngles:
                    - "Pain relief without pills"
                    - "Get back to walking comfortably"
                  foundationalDocText: "Long research/context text..."
                  forcedReferenceImageIds:
                    - "12.png"
                    - "23.webp"
                  uploadedReferenceImageUrls:
                    - "https://imagedelivery.net/abc123/ref-image-1.png"
                    - "https://imagedelivery.net/abc123/ref-image-2.webp"
                  productImageUrls:
                    - "https://example-bucket.s3.eu-west-1.amazonaws.com/presigned-url"
                  language: "english"
                  productName: "meritrelief"
                  imageGenerationProvider: "openai"
      responses:
        '202':
          description: Job accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitJobResponse'
              examples:
                accepted:
                  value:
                    jobId: "c3f0e0c4-3a61-4c52-8b5a-2e0a8b8b4a5f"
                    status: "SUBMITTED"
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-codeSamples:
        - lang: bash
          label: curl (submit image-gen)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -X POST \
              -H "Authorization: Bearer $ACCESS_TOKEN" \
              -H "content-type: application/json" \
              -d '{
                "selectedAvatar": "Men 50-65, skeptical, wants fast relief",
                "selectedAngles": ["Pain relief without pills", "Get back to walking comfortably"],
                "productImageUrls": ["https://example-bucket.s3.eu-west-1.amazonaws.com/presigned-url"],
                "productName": "meritrelief",
                "language": "english"
              }' \
              "${API_URL}image-gen/generate"
  /image-gen/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get image generation job status
      operationId: getImageGenJob
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatusResponse'
        '404':
          description: Job not found
          content:
            text/plain:
              schema:
                type: string
                example: "Not found"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (status)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}image-gen/YOUR_JOB_ID"
  /image-gen/{id}/result:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get image generation results
      operationId: getImageGenResult
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Image generation result JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageGenResult'
            text/plain:
              schema:
                type: string
        '404':
          description: Result not available
          content:
            text/plain:
              schema:
                type: string
                example: "Result not available"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (result)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}image-gen/YOUR_JOB_ID/result"
  /dev/swipe-files/generate:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit a swipe file generation job (DEV MODE)
      description: Submits a swipe file generation job in development mode. Returns mock swipe files.
      operationId: submitSwipeFileGenerationDev
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [original_job_id, select_angle]
              properties:
                original_job_id:
                  type: string
                  format: uuid
                  description: The job ID of the original comprehensive analysis job
                select_angle:
                  type: string
                  description: The marketing angle to focus on for the swipe files
                swipe_file_ids:
                  type: array
                  description: The IDs of the swipe files to generate
                  items:
                    type: string
                    format: uuid
      responses:
        '202':
          description: Swipe file generation job accepted (Dev Mode)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitSwipeFileResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  # ===== V2 API Endpoints =====
  /v2/jobs:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit a new job (V2 - General Research Flow)
      description: |
        V2 endpoint for submitting jobs using the new general research flow.
        This endpoint performs deep research to automatically identify multiple customer avatars
        and generates marketing angles for each.
        
        **Breaking changes from v1:**
        - `sales_page_url` and `project_name` are now required
        - `customer_avatars`, `persona`, and `age_range` fields are rejected (400 error)
        - Response includes `identified_avatars`, multiple `avatar_sheet` entries, and `necessary_beliefs`
      operationId: submitJobV2
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitJobV2Request'
            examples:
              minimal:
                summary: Minimal required payload
                value:
                  sales_page_url: "https://try.meritrelief.com/"
                  project_name: "meritrelief"
              full:
                summary: Full payload with optional fields
                value:
                  sales_page_url: "https://try.meritrelief.com/"
                  project_name: "meritrelief"
                  advertorial_type: "Listicle"
                  research_requirements: "Focus on natural ingredients and FDA approval status"
                  gender: "Female"
                  location: "USA"
      responses:
        '202':
          description: Job accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitJobResponse'
              examples:
                accepted:
                  value:
                    jobId: "c3f0e0c4-3a61-4c52-8b5a-2e0a8b8b4a5f"
                    status: "SUBMITTED"
        '400':
          description: Invalid request body (missing required fields or deprecated fields used)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                deprecated_fields:
                  summary: Deprecated fields used
                  value:
                    error: "Deprecated fields not allowed in v2 API: customer_avatars"
                missing_required:
                  summary: Missing required fields
                  value:
                    error: "Missing required fields: project_name, sales_page_url"
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-codeSamples:
        - lang: bash
          label: curl (submit v2)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -X POST \
              -H "Authorization: Bearer $ACCESS_TOKEN" \
              -H "content-type: application/json" \
              -d '{
                "sales_page_url": "https://try.meritrelief.com/",
                "project_name": "meritrelief",
                "research_requirements": "Focus on natural ingredients",
                "gender": "Female",
                "location": "USA"
              }' \
              "${API_URL}v2/jobs"
  /v2/jobs/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get job status (V2)
      operationId: getJobV2
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatusResponse'
        '404':
          description: Job not found
          content:
            text/plain:
              schema:
                type: string
                example: "Not found"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (status v2)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}v2/jobs/YOUR_JOB_ID"
  /v2/jobs/{id}/result:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    get:
      summary: Get job result (V2)
      description: |
        Returns the comprehensive job result including:
        - `avatars`: Full avatar details with marketing angles for each
        - `necessary_beliefs_per_avatar`: 6 necessary beliefs extracted per avatar
        - `summary`: Copywriter-friendly summary of all outputs
      operationId: getJobResultV2
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/read
      responses:
        '200':
          description: Job result JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResultV2'
            text/plain:
              schema:
                type: string
        '404':
          description: Result not available
          content:
            text/plain:
              schema:
                type: string
                example: "Result not available"
        '500':
          description: Server error
          content:
            text/plain:
              schema:
                type: string
      x-codeSamples:
        - lang: bash
          label: curl (result v2)
          source: |-
            API_URL="https://o5egokjpsl.execute-api.eu-west-1.amazonaws.com/prod/"
            curl -sS -H "Authorization: Bearer $ACCESS_TOKEN" "${API_URL}v2/jobs/YOUR_JOB_ID/result"
  /dev/v2/jobs:
    options:
      summary: CORS preflight
      responses:
        '204':
          description: No Content
          headers:
            Access-Control-Allow-Origin: { $ref: '#/components/headers/AccessControlAllowOrigin' }
            Access-Control-Allow-Headers: { $ref: '#/components/headers/AccessControlAllowHeaders' }
            Access-Control-Allow-Methods: { $ref: '#/components/headers/AccessControlAllowMethods' }
    post:
      summary: Submit a new job (V2 - DEV MODE)
      description: |
        V2 endpoint in development mode. Uses pre-computed mock data instead of running full AI processing.
        Same validation rules as production V2 endpoint.
      operationId: submitJobV2Dev
      security:
        - cognitoOAuth2:
            - https://deep-copy.api/write
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitJobV2Request'
      responses:
        '202':
          description: Job accepted (Dev Mode)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubmitJobResponse'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  securitySchemes:
    cognitoOAuth2:
      type: oauth2
      description: |
        OAuth2 client credentials against Amazon Cognito User Pool domain.
        Use the token endpoint output by the stack to obtain an access token.
      flows:
        clientCredentials:
          tokenUrl: https://deepcopy-613663743323-eu-west-1.auth.eu-west-1.amazoncognito.com/oauth2/token
          scopes:
            https://deep-copy.api/read: Read jobs and results
            https://deep-copy.api/write: Submit jobs
  schemas:
    SubmitJobV2Request:
      type: object
      description: Request body for V2 jobs endpoint (general research flow)
      required: [sales_page_url, project_name]
      additionalProperties: false
      properties:
        sales_page_url:
          type: string
          format: uri
          description: URL to the sales page to analyze (required)
        project_name:
          type: string
          description: Name of the project (required)
        advertorial_type:
          type: string
          description: Type of advertorial to generate (e.g., 'Listicle', 'Advertorial')
        research_requirements:
          type: string
          description: Optional specific requirements or focus areas for the research
        gender:
          type: string
          description: Optional gender target (e.g., 'Male', 'Female', 'N/A')
        location:
          type: string
          description: Optional location target
      example:
        sales_page_url: "https://try.meritrelief.com/"
        project_name: "meritrelief"
        advertorial_type: "Listicle"
        research_requirements: "Focus on natural ingredients"
        gender: "Female"
        location: "USA"
    JobResultV2:
      type: object
      description: Structured JSON produced by the V2 pipeline with multiple avatars and necessary beliefs.
      additionalProperties: false
      properties:
        project_name:
          type: string
        timestamp_iso:
          type: string
          format: date-time
        job_id:
          type: string
        api_version:
          type: string
          description: API version used to submit the job (v2)
        results:
          type: object
          additionalProperties: false
          properties:
            research_page_analysis:
              type: string
              description: Analysis of the sales page
            deep_research_prompt:
              type: string
              description: The prompt used for deep research
            deep_research_output:
              type: string
              description: Raw output from deep research
            marketing_avatars:
              type: array
              description: List of marketing avatars with their generated angles and necessary beliefs
              items:
                type: object
                properties:
                  avatar:
                    $ref: '#/components/schemas/Avatar'
                  angles:
                    $ref: '#/components/schemas/AvatarMarketingAngles'
                  necessary_beliefs:
                    type: string
                    description: 6 necessary beliefs extracted for this avatar
            summary:
              type: string
              description: Copywriter-friendly summary of all outputs
      required: [project_name, timestamp_iso, results, job_id]
    SubmitJobRequest:
      type: object
      additionalProperties: true
      properties:
        sales_page_url:
          type: string
          format: uri
          description: URL to the sales page to analyze
        project_name:
          type: string
        advertorial_type:
          type: string
        research_requirements:
          type: string
          description: Optional specific requirements or focus areas for the research
        gender:
          type: string
          description: Optional gender target (e.g. 'Male', 'Female', 'N/A')
        location:
          type: string
          description: Optional location target
        customer_avatars:
          type: array
          description: (Deprecated) List of customer avatars/personas to target. Ignored in new flow.
          items:
            $ref: '#/components/schemas/CustomerAvatar'
        persona:
          type: string
          deprecated: true
          description: (Deprecated) Use customer_avatars instead
        age_range:
          type: string
          deprecated: true
          description: (Deprecated) Use customer_avatars instead
        gender_deprecated:
          type: string
          deprecated: true
          description: (Deprecated) Use 'gender' field instead
      example:
        sales_page_url: "https://try.meritrelief.com/"
        project_name: "meritrelief"
        advertorial_type: "Listicle"
        research_requirements: "Focus on natural ingredients"
        gender: "Female"
        location: "USA"
    SubmitJobResponse:
      type: object
      required: [jobId, status]
      properties:
        jobId:
          type: string
          format: uuid
        taskArn:
          type: string
          nullable: true
        status:
          type: string
          enum: [SUBMITTED]
    JobStatusResponse:
      type: object
      required: [jobId, status]
      properties:
        jobId:
          type: string
        status:
          type: string
          description: Current job status, e.g. SUBMITTED, RUNNING, SUCCEEDED, FAILED
        api_version:
          type: string
          description: API version used to submit the job (e.g., 'v2')
    JobResult:
      type: object
      description: Structured JSON produced by the pipeline including rewritten advertorial content.
      additionalProperties: false
      properties:
        project_name:
          type: string
        timestamp_iso:
          type: string
          format: date-time
        job_id:
          type: string
        api_version:
          type: string
          description: API version (v1)
        results:
          type: object
          additionalProperties: false
          properties:
            research_page_analysis:
              type: string
            doc1_analysis:
              type: string
            doc2_analysis:
              type: string
            deep_research_prompt:
              type: string
            deep_research_output:
              type: string
            avatar_sheet:
              $ref: '#/components/schemas/AvatarList'
            identified_avatars:
              $ref: '#/components/schemas/IdentifiedAvatarList'
            offer_brief:
              $ref: '#/components/schemas/OfferBrief'
            marketing_philosophy_analysis:
              type: string
            necessary_beliefs:
              type: string
            summary:
              type: string
            swipe_results:
              type: array
              items:
                $ref: '#/components/schemas/SwipeResult'
            marketing_angles:
              type: array
              items:
                $ref: '#/components/schemas/Angle'
            customer_avatars:
              type: array
              description: Simplified list of identified avatars
              items:
                $ref: '#/components/schemas/IdentifiedAvatar'
      required: [project_name, timestamp_iso, results, job_id]
    SwipeResult:
      type: object
      description: Result item for a specific marketing angle containing structured advertorial content.
      required: [angle, content]
      properties:
        angle:
          type: string
          description: Marketing angle used to generate the content.
        content:
          description: Structured content; either a Listicle or an Avertorial.
          oneOf:
            - $ref: '#/components/schemas/Listicle'
            - $ref: '#/components/schemas/Advertorial'
    ListicleItem:
      type: object
      required: [number, title, description]
      properties:
        number:
          type: integer
          description: Number of the listicle item.
        title:
          type: string
          description: Title of the listicle item.
        description:
          type: string
          description: Description of the listicle item.
    Listicle:
      type: object
      description: Structured Listicle content returned by the pipeline.
      required: [title, author, summary, listicles, cta, conclusion]
      properties:
        title:
          type: string
          description: Title of the listicle.
        author:
          type: string
          description: Author and date of the listicle.
        summary:
          type: string
          description: Intro/summary paragraph of the listicle.
        listicles:
          type: array
          description: List of listicle items.
          items:
            $ref: '#/components/schemas/ListicleItem'
        cta:
          type: string
          description: Call-to-action of the listicle.
        conclusion:
          type: string
          description: Conclusion of the listicle.
    Advertorial:
      type: object
      description: Structured Advertorial content returned by the pipeline.
      required: [title, subtitle, body, cta, captions]
      properties:
        title:
          type: string
          description: Title of the advertorial.
        subtitle:
          type: string
          description: Subtitle of the advertorial.
        body:
          type: string
          description: Body/content of the advertorial.
        cta:
          type: string
          description: Call-to-action of the advertorial.
        captions:
          type: string
          description: Captions of the advertorial.
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
    SubmitAvatarExtractionResponse:
      type: object
      required: [jobId, status]
      properties:
        jobId:
          type: string
          format: uuid
          description: Avatar extraction job ID
        status:
          type: string
          enum: [SUBMITTED]
          description: Job status
    AvatarExtractionResponse:
      type: object
      required: [success, url, job_id, timestamp_iso, avatars, company_type, product_description, product_image]
      properties:
        success:
          type: boolean
          description: Whether the extraction was successful
        url:
          type: string
          format: uri
          description: The URL that was analyzed
        job_id:
          type: string
          description: The job ID for this extraction
        timestamp_iso:
          type: string
          format: date-time
          description: When the extraction was completed
        avatars:
          type: array
          description: List of extracted customer avatars
          items:
            $ref: '#/components/schemas/CustomerAvatar'
        company_type:
          type: string
          description: The type of company the product is for
        product_description:
          type: string
          description: A description of the product
        product_image:
          type: string
          description: Base64 encoded string of the product image

    SubmitSwipeFileResponse:
      type: object
      required: [jobId, status]
      properties:
        jobId:
          type: string
          format: uuid
          description: Swipe file generation job ID
        status:
          type: string
          enum: [SUBMITTED]
          description: Job status
    SubmitImageGenRequest:
      type: object
      additionalProperties: false
      required: [selectedAvatar, selectedAngles]
      properties:
        foundationalDocText:
          type: string
          description: Optional research/context text blob
        selectedAvatar:
          type: string
          description: Selected avatar/persona description
        selectedAngles:
          type: array
          minItems: 1
          items:
            type: string
          description: List of marketing angles to generate images for
        forcedReferenceImageIds:
          type: array
          items:
            type: string
          description: Optional reference creative IDs to force into assignments (e.g. 12.png, 23.webp)
        uploadedReferenceImageUrls:
          type: array
          items:
            type: string
            format: uri
          description: Optional URLs for user-uploaded reference images (from Cloudflare). System will check if each contains a product image using AI vision and use product image from productImageUrls if detected.
        productImageUrls:
          type: array
          items:
            type: string
            format: uri
          description: Optional presigned URLs for product images (processor downloads)
        language:
          type: string
          default: english
        productName:
          type: string
        imageGenerationProvider:
          type: string
          enum: [openai, nano_banana]
          description: Optional override for the image generation provider
    ImageGenResult:
      type: object
      additionalProperties: true
      properties:
        job_id:
          type: string
        timestamp_iso:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
        analysisResults:
          type: object
          additionalProperties: true
        generatedImages:
          type: array
          items:
            type: object
            additionalProperties: true
    SwipeFileGenerationResponse:
      type: object
      description: Swipe file generation results containing rewritten advertorial content
      additionalProperties: true
      properties:
        L00001:
          type: object
          description: Generated swipe file for template L00001
          additionalProperties: true
        A00003:
          type: object
          description: Generated swipe file for template A00003
          additionalProperties: true
      example:
        L00001:
          full_advertorial:
            title: "Example Title"
            subtitle: "Example Subtitle"
        A00003:
          full_advertorial:
            title: "Example Title"
            subtitle: "Example Subtitle"
    AvatarDemographics:
      type: object
      description: "Section A: Demographic Profile"
      required: [age_range, gender, occupation, income_level, location_type, family_situation, education_level, one_sentence_description]
      properties:
        age_range:
          type: string
          description: "Age Range"
        gender:
          type: string
          description: "Gender"
        occupation:
          type: string
          description: "Occupation / Life Stage"
        income_level:
          type: string
          description: "Income Level"
        location_type:
          type: string
          description: "Location Type: (urban / suburban / rural)"
        family_situation:
          type: string
          description: "Family Situation: (single / married / divorced / kids at home / empty nest)"
        education_level:
          type: string
          description: "Education Level"
        one_sentence_description:
          type: string
          description: "Who they are and what makes their situation unique"
    AvatarProblemExperience:
      type: object
      description: "Section B: Problem Experience"
      required: [duration, severity, frequency, trigger_event, daily_life_impact, social_impact, who_else_knows]
      properties:
        duration:
          type: string
          description: "Problem Duration: How long have they been dealing with this?"
        severity:
          type: string
          description: "Problem Severity: Early stage / Moderate / Severe / Crisis"
        frequency:
          type: string
          description: "Problem Frequency: How often do they think about it? Daily obsession vs. occasional annoyance?"
        trigger_event:
          type: string
          description: "Trigger Event: What specific moment made them start actively searching for a solution?"
        daily_life_impact:
          type: string
          description: "Daily Life Impact: How does this problem affect their everyday activities?"
        social_impact:
          type: string
          description: "Social Impact: How does this affect relationships, work, public situations?"
        who_else_knows:
          type: string
          description: "Who Else Knows: Is this a private struggle or do others know? Who have they told?"
    AvatarPainDimensions:
      type: object
      description: "Section C: Pain Dimensions"
      required: [surface_pain, emotional_pain, social_pain, identity_pain, secret_pain, dominant_negative_emotion]
      properties:
        surface_pain:
          type: string
          description: "Surface Pain (Physical/Practical): The problem as they describe it in literal terms"
        emotional_pain:
          type: string
          description: "Emotional Pain: The feelings this problem creates — shame, frustration, fear, anger"
        social_pain:
          type: string
          description: "Social Pain: How this affects how others see them or how they show up in the world"
        identity_pain:
          type: string
          description: "Identity Pain: How this conflicts with who they believe they are or want to be"
        secret_pain:
          type: string
          description: "Secret Pain: What they won't say out loud but feel deeply"
        dominant_negative_emotion:
          type: string
          description: "Dominant Negative Emotion: The ONE emotion that dominates — shame / fear / frustration / hopelessness / anger"
    AvatarDesireDimensions:
      type: object
      description: "Section D: Desire Dimensions"
      required: [surface_desire, emotional_desire, social_desire, identity_desire, secret_desire, dream_outcome]
      properties:
        surface_desire:
          type: string
          description: "Surface Desire: What they say they want — the obvious fix"
        emotional_desire:
          type: string
          description: "Emotional Desire: How they want to FEEL"
        social_desire:
          type: string
          description: "Social Desire: How they want to be SEEN by others"
        identity_desire:
          type: string
          description: "Identity Desire: Who they want to BECOME"
        secret_desire:
          type: string
          description: "Secret Desire: The deeper want they might not admit"
        dream_outcome:
          type: string
          description: "Dream Outcome: If this problem was completely solved, what does their life look like?"
    AvatarAwareness:
      type: object
      description: "Section E: Awareness & Sophistication"
      required: [problem_awareness, solution_awareness, product_awareness, market_sophistication, schwartz_awareness_level]
      properties:
        problem_awareness:
          type: string
          description: "Problem Awareness: Do they know exactly what's causing this, or are they confused?"
        solution_awareness:
          type: string
          description: "Solution Awareness: Do they know solutions exist? Have they researched options?"
        product_awareness:
          type: string
          description: "Product Awareness: Do they know about products like ours specifically?"
        market_sophistication:
          type: string
          description: "Market Sophistication: How much have they seen? First-time buyer vs. seen-it-all skeptic?"
        schwartz_awareness_level:
          type: string
          description: "Schwartz Awareness Level: Unaware / Problem-Aware / Solution-Aware / Product-Aware / Most Aware"
    AvatarFailedSolutions:
      type: object
      description: "Section F: Failed Solution History"
      required: [solutions_tried, money_spent, why_failed, beliefs_about_failure, current_coping]
      properties:
        solutions_tried:
          type: string
          description: "Solutions Already Tried: List everything they've attempted"
        money_spent:
          type: string
          description: "Money Already Spent: Approximate total spent on this problem"
        why_failed:
          type: string
          description: "Why Past Solutions Failed: In their words — what went wrong?"
        beliefs_about_failure:
          type: string
          description: "Belief About Why Nothing Works: What conclusion have they drawn about why they can't solve this?"
        current_coping:
          type: string
          description: "Current Coping Mechanism: What are they doing now to manage the problem?"
    AvatarObjections:
      type: object
      description: "Section G: Objections & Skepticism"
      required: [primary_objection, secondary_objections, hidden_objection, skepticism_source, proof_needed, trusted_sources]
      properties:
        primary_objection:
          type: string
          description: "Primary Objection: The #1 reason they would NOT buy"
        secondary_objections:
          type: string
          description: "Secondary Objections: Other concerns"
        hidden_objection:
          type: string
          description: "Hidden Objection: What they're really worried about but won't say"
        skepticism_source:
          type: string
          description: "Source of Skepticism: Why don't they trust solutions? Past experience? General cynicism?"
        proof_needed:
          type: string
          description: "What Proof Would They Need: What evidence would overcome their skepticism?"
        trusted_sources:
          type: string
          description: "Whose Opinion Do They Trust: Doctors? Friends? Online reviews? Celebrities? People like them?"
    AvatarBuyingPsychology:
      type: object
      description: "Section H: Buying Psychology"
      required: [decision_making_style, budget_range, price_sensitivity, risk_tolerance, decision_influencers, buying_urgency, buy_today_trigger, dealbreaker]
      properties:
        decision_making_style:
          type: string
          description: "Decision-Making Style: Impulse buyer / Careful researcher / Needs permission / Analysis paralysis"
        budget_range:
          type: string
          description: "Budget Range: What would they realistically pay for a solution?"
        price_sensitivity:
          type: string
          description: "Price Sensitivity: Very sensitive / Moderate / Will pay premium for results"
        risk_tolerance:
          type: string
          description: "Risk Tolerance: Will they try something new easily, or need heavy reassurance?"
        decision_influencers:
          type: string
          description: "Who Influences Their Decision: Spouse? Doctor? Friends? No one — solo decider?"
        buying_urgency:
          type: string
          description: "Buying Urgency: Need it now / Can wait / Just browsing"
        buy_today_trigger:
          type: string
          description: "What Would Make Them Buy TODAY: The specific trigger or offer that converts them immediately"
        dealbreaker:
          type: string
          description: "What Would Make Them Walk Away: The dealbreaker that kills the sale"
    AvatarInformationComm:
      type: object
      description: "Section I: Information & Communication"
      required: [info_sources, content_format, language_style, problem_vocab, avoided_words, resonating_tone]
      properties:
        info_sources:
          type: string
          description: "Where They Seek Information: Google / YouTube / Reddit / Facebook Groups / Doctor / Friends"
        content_format:
          type: string
          description: "Preferred Content Format: Video / Text / Images / Testimonials / Data"
        language_style:
          type: string
          description: "Language Style: Clinical and technical / Casual and emotional / Direct and simple"
        problem_vocab:
          type: string
          description: "Words They Use to Describe Problem: Their exact vocabulary"
        avoided_words:
          type: string
          description: "Words They Avoid: Terms that feel too clinical, embarrassing, or off-putting"
        resonating_tone:
          type: string
          description: "Tone That Resonates: Empathetic / Authoritative / Peer-to-peer / Clinical / Urgent"
    AvatarRawLanguage:
      type: object
      description: "Section J: Raw Language Map"
      required: [pain_language, desire_language, objection_language, failed_solution_language]
      properties:
        pain_language:
          type: array
          description: "Pain Language (3+ quotes): Direct quotes expressing pain"
          items:
            type: string
        desire_language:
          type: array
          description: "Desire Language (3+ quotes): Direct quotes expressing desire"
          items:
            type: string
        objection_language:
          type: array
          description: "Objection Language (2+ quotes): Direct quotes expressing skepticism/objection"
          items:
            type: string
        failed_solution_language:
          type: array
          description: "Failed Solution Language (2+ quotes): Direct quotes about what they've tried"
          items:
            type: string
    AvatarStrategicSummary:
      type: object
      description: "Section K: Strategic Summary"
      required: [market_size, buying_readiness, competitive_saturation, message_match_difficulty, one_line_hook]
      properties:
        market_size:
          type: string
          description: "Market Size Estimate: Small / Medium / Large — based on frequency in research"
        buying_readiness:
          type: string
          description: "Buying Readiness: Cold / Warm / Hot"
        competitive_saturation:
          type: string
          description: "Competitive Saturation: Are competitors already targeting this avatar heavily?"
        message_match_difficulty:
          type: string
          description: "Message Match Difficulty: Easy to reach with messaging / Requires nuanced approach"
        one_line_hook:
          type: string
          description: "One-Line Hook That Would Stop Them: A headline or opening that would grab THIS avatar specifically"
    AvatarRanking:
      type: object
      description: "Section L: Ranking"
      required: [ranking, reason]
      properties:
        ranking:
          type: integer
          description: "High, medium, low based on market size x buying readiness"
        reason:
          type: string
          description: "Reason for the ranking"
    MarketingAngle:
      type: object
      description: "A generated marketing angle"
      required: [angle_title, angle_subtitle, angle_type, emotional_driver, risk_level, core_argument, target_age_range, target_audience, pain_points, desires, common_objections, failed_alternatives, pain_quotes, desire_quotes, objection_quotes]
      properties:
        angle_title:
          type: string
          description: "A name for this specific pitch"
        angle_subtitle:
          type: string
          description: "A short tagline that captures the angle's promise"
        angle_type:
          type: string
          description: "The category of argument being made (e.g., Pain-Lead, Desire-Lead, etc.)"
        emotional_driver:
          type: string
          description: "The primary emotion this angle triggers (Fear / Hope / Anger / Shame / Desire)"
        risk_level:
          type: string
          description: "Compliance or proof risk for running this angle (Low / Medium / High)"
        core_argument:
          type: string
          description: "The single-sentence logical argument this angle makes"
        target_age_range:
          type: string
          description: "The age bracket this angle speaks to"
        target_audience:
          type: string
          description: "A refined description of who this specific angle is for"
        pain_points:
          type: array
          description: "The most relevant frustrations for this particular angle"
          items:
            type: string
        desires:
          type: array
          description: "The most relevant goals and wants for this particular angle"
          items:
            type: string
        common_objections:
          type: array
          description: "Why this person might say 'no' to this specific pitch"
          items:
            type: string
        failed_alternatives:
          type: array
          description: "What they've tried before that didn't work — and why this angle addresses it"
          items:
            type: string
        pain_quotes:
          type: array
          description: "Direct quotes from research expressing the pain this angle targets"
          items:
            type: string
        desire_quotes:
          type: array
          description: "Direct quotes from research expressing the desire this angle promises"
          items:
            type: string
        objection_quotes:
          type: array
          description: "Direct quotes from research expressing skepticism this angle must overcome"
          items:
            type: string
    TopAngle:
      type: object
      description: "Top selected angle"
      required: [name, angle_type, core_argument, why_selected, primary_hook, emotional_driver, risk_level]
      properties:
        name:
          type: string
          description: "Name of the angle"
        angle_type:
          type: string
          description: "Type of angle"
        core_argument:
          type: string
          description: "Core argument"
        why_selected:
          type: string
          description: "Reason for selection"
        primary_hook:
          type: string
          description: "Primary hook"
        emotional_driver:
          type: string
          description: "Emotional driver"
        risk_level:
          type: string
          description: "Risk level (Low/Medium/High)"
    Top3Angles:
      type: object
      description: "Top 3 angles for an avatar"
      required: [primary_angle, secondary_angle, test_angle]
      properties:
        primary_angle:
          $ref: '#/components/schemas/TopAngle'
        secondary_angle:
          $ref: '#/components/schemas/TopAngle'
        test_angle:
          $ref: '#/components/schemas/TopAngle'
    AvatarMarketingAngles:
      type: object
      description: "Marketing angles generated for a specific avatar"
      required: [avatar_name, generated_angles, top_3_angles]
      properties:
        avatar_name:
          type: string
          description: "Name of the avatar"
        generated_angles:
          type: array
          items:
            $ref: '#/components/schemas/MarketingAngle'
          description: "List of 5-7 distinct marketing angles"
        top_3_angles:
          $ref: '#/components/schemas/Top3Angles'
          description: "Selection of top 3 angles"
    Angle:
      type: object
      required: [angle, title, target_age_range, target_audience, pain_points, desires, common_objections, failed_alternatives, copy_approach]
      properties:
        angle:
          type: string
          description: "The marketing angle for the product"
        title:
          type: string
          description: "The title of the marketing angle"
        target_age_range:
          type: string
          description: "The target age range for the marketing angle. Note it like: 45-55, 60-70, etc."
        target_audience:
          type: string
          description: "The target audience for the marketing angle. Note it like: Competitive athletes seeking reliability, Skilled professionals seeking productivity, etc."
        pain_points:
          type: array
          description: "The pain points for the marketing angle"
          items:
            type: string
        desires:
          type: array
          description: "The desires for the marketing angle"
          items:
            type: string
        common_objections:
          type: array
          description: "The common objections for the marketing angle"
          items:
            type: string
        failed_alternatives:
          type: array
          description: "The failed alternatives for the marketing angle"
          items:
            type: string
        copy_approach:
          type: array
          description: "The copy approaches for the marketing angle"
          items:
            type: string
    Avatar:
      type: object
      description: "Marketing Avatar sheet for product–market fit & messaging research"
      required: [name, demographics, problem_experience, pain_dimensions, desire_dimensions, awareness, failed_solutions, objections, buying_psychology, info_comm, raw_language, strategic_summary, ranking]
      properties:
        name:
          type: string
          description: "Descriptive Name of the Avatar"
        demographics:
          $ref: '#/components/schemas/AvatarDemographics'
        problem_experience:
          $ref: '#/components/schemas/AvatarProblemExperience'
        pain_dimensions:
          $ref: '#/components/schemas/AvatarPainDimensions'
        desire_dimensions:
          $ref: '#/components/schemas/AvatarDesireDimensions'
        awareness:
          $ref: '#/components/schemas/AvatarAwareness'
        failed_solutions:
          $ref: '#/components/schemas/AvatarFailedSolutions'
        objections:
          $ref: '#/components/schemas/AvatarObjections'
        buying_psychology:
          $ref: '#/components/schemas/AvatarBuyingPsychology'
        info_comm:
          $ref: '#/components/schemas/AvatarInformationComm'
        raw_language:
          $ref: '#/components/schemas/AvatarRawLanguage'
        strategic_summary:
          $ref: '#/components/schemas/AvatarStrategicSummary'
        ranking:
          $ref: '#/components/schemas/AvatarRanking'
    CustomerAvatar:
      type: object
      required: [persona_name, characteristics, description, age_range, gender, key_buying_motivation, pain_point, emotion, desire, objections, failed_alternatives]
      properties:
        persona_name:
          type: string
          description: A short, descriptive name that captures the essence of the customer
        characteristics:
          type: array
          description: Characteristics of the customer, e.g. Stands all day, Active lifestyle, etc. Provide at least 3 characteristics and max three words each.
          items:
            type: string
        description:
          type: string
          description: 1 sentence summarizing their lifestyle, motivations, and key challenges
        age_range:
          type: string
          description: Approximate age bracket (e.g., 25-34)
        gender:
          type: string
          description: male, female, or both
        key_buying_motivation:
          type: string
          description: What drives them to purchase this product
        pain_point:
          type: string
          description: Specific problem or challenge the customer faces
        emotion:
          type: string
          description: Emotion they feel related to the pain point
        desire:
          type: string
          description: What they desire as a solution to their pain point
        objections:
          type: array
          description: List of objections or concerns they might have
          items:
            type: string
        failed_alternatives:
          type: array
          description: List of alternatives they've tried that didn't work
          items:
            type: string
        is_broad_avatar:
          type: boolean
          description: Whether this avatar represents the overall customer base
    IdentifiedAvatar:
      type: object
      required: [name, description]
      properties:
        name:
          type: string
          description: Name of the avatar (e.g., 'Busy Mom')
        description:
          type: string
          description: Brief description of who they are and why they are a good fit
    IdentifiedAvatarList:
      type: object
      required: [avatars]
      properties:
        avatars:
          type: array
          items:
            $ref: '#/components/schemas/IdentifiedAvatar'
          description: List of potential customer avatars
    AvatarList:
      type: object
      required: [avatars]
      properties:
        avatars:
          type: array
          items:
            $ref: '#/components/schemas/Avatar'
          description: List of identified customer avatars
    ConsciousnessLevel:
      type: string
      enum: [low, high]
      description: How self-aware and change-ready the prospect is
    AwarenessLevel:
      type: string
      enum: [unaware, problem_aware, solution_aware, product_aware, most_aware]
      description: Prospect's awareness per Schwartz's stages
    SophisticationLevel:
      type: string
      enum: [level_1, level_2, level_3, level_4, level_5]
      description: Market sophistication level (make claims → mechanisms → advanced strategies)
    StageOfSophistication:
      type: object
      required: [level]
      properties:
        level:
          $ref: '#/components/schemas/SophisticationLevel'
        rationale:
          type: string
          nullable: true
          description: Why this level fits (signals from ads, competitors, buyer skepticism)
    HeadlineIdea:
      type: object
      required: [headline]
      properties:
        headline:
          type: string
          description: Punchy primary promise or hook
        subheadline:
          type: string
          nullable: true
          description: Clarifies/grounds the headline with specifics, mechanism, or outcome
    BeliefChain:
      type: object
      required: [outcome, steps]
      properties:
        outcome:
          type: string
          description: What the buyer must feel confident about (e.g., 'This can work for me')
        steps:
          type: array
          description: Ordered micro-beliefs (e.g., problem is real → solution type works → this product's mechanism works → I can use it)
          items:
            type: string
    SwipeExample:
      type: object
      required: [title]
      properties:
        title:
          type: string
          description: Short label for the swipe (publisher, creator, or concept)
        url:
          type: string
          format: uri
          nullable: true
          description: Link to the asset if available
        notes:
          type: string
          nullable: true
          description: "What to model: headline structure, proof style, funnel flow, etc."
    ProductInfo:
      type: object
      properties:
        name:
          type: string
          nullable: true
          description: Working name of the product/offer
        description:
          type: string
          nullable: true
          description: What it is, who it's for, core outcomes/benefits
        details:
          type: string
          nullable: true
          description: Format, modules, deliverables, bonuses, guarantees, price points, terms
    OfferBrief:
      type: object
      description: Structured brief to guide AI when generating copy, concepts, and funnel assets
      properties:
        potential_product_names:
          type: array
          description: Brainstormed product/offer name options
          items:
            type: string
        level_of_consciousness:
          $ref: '#/components/schemas/ConsciousnessLevel'
          description: Prospect's general self-awareness/readiness to change
        level_of_awareness:
          $ref: '#/components/schemas/AwarenessLevel'
          description: Prospect's current awareness of problem/solution/product
        stage_of_sophistication:
          $ref: '#/components/schemas/StageOfSophistication'
          description: Market sophistication selection with reasoning
        big_idea:
          type: string
          nullable: true
          description: Single, transformative central idea that unifies the campaign
        metaphors:
          type: array
          description: Images/analogies to make the big idea and mechanism vivid
          items:
            type: string
        potential_ump:
          type: array
          description: "Unique Mechanism of the Problem: counterintuitive reason the problem persists"
          items:
            type: string
        potential_ums:
          type: array
          description: "Unique Mechanism of the Solution: how THIS solution uniquely works"
          items:
            type: string
        guru:
          type: string
          nullable: true
          description: Authority or spokesperson (real or archetype) associated with the offer
        discovery_story:
          type: string
          nullable: true
          description: "Origin narrative: aha moment, failed attempts, breakthrough mechanism"
        product:
          $ref: '#/components/schemas/ProductInfo'
          description: Core product details to anchor claims and copy
        headline_ideas:
          type: array
          description: Potential headline/subheadline pairs for ads, LPs, emails
          items:
            $ref: '#/components/schemas/HeadlineIdea'
        objections:
          type: array
          description: All likely objections (price, time, credibility, fit, complexity, risk)
          items:
            type: string
        belief_chains:
          type: array
          description: Required belief paths the buyer must traverse to purchase
          items:
            $ref: '#/components/schemas/BeliefChain'
        funnel_architecture:
          type: array
          description: High-level funnel steps in order (e.g., 'Ad → Lead Magnet → Nurture → VSL → Checkout → Upsell')
          items:
            type: string
        potential_domains:
          type: array
          description: Available or desired domains/URLs for the offer
          items:
            type: string
        examples_swipes:
          type: array
          description: Reference campaigns, pages, or ads to emulate
          items:
            $ref: '#/components/schemas/SwipeExample'
        other_notes:
          type: string
          nullable: true
          description: "Anything else helpful: compliance constraints, must-include proof, JTBD, ICP nuances"
  headers:
    AccessControlAllowOrigin:
      schema:
        type: string
        example: "*"
      description: CORS allow origin
    AccessControlAllowHeaders:
      schema:
        type: string
        example: "*"
      description: CORS allow headers
    AccessControlAllowMethods:
      schema:
        type: string
        example: "*"
      description: CORS allow methods
